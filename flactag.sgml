<!doctype linuxdoc system>
<article>
<title>FLACTAG v0.04
<author>Andy Hawkins <url url="mailto:andy@gently.org.uk" name="andy@gently.org.uk">
<abstract>
A utility for tagging single album FLAC files with embedded CUE sheets 
using data from the <url url="http://www.musicbrainz.org" name="MusicBrainz"> service.
</abstract>
<toc>
<sect>Downloading
<p>
The latest version of flactag can always be found <url url="http://www.gently.org.uk/flactag" name="here">.

The current version is <url url="flactag-0.04.tar.gz" name="v0.04">.
<sect>Requirements
<p>
<itemize>
<item><url url="http://musicbrainz.org/doc/libmusicbrainzDownload" name="libmusicbrainz"> (I used version 2.1.4)
<item><url url="http://flac.sourceforge.net/download.html" name="libflac++"> (I used version 1.1.1)
<item><url url="http://www.s-lang.org/download.html" name="S-Lang"> (I used version 1.4.9)
<item><url url="http://http-fetcher.sourceforge.net/downloads.html" name="http-fetcher"> (I used version 1.0.1)
</itemize>
<sect>Building
<p>
To build the software, simply run '<bf>make</bf>' in the directory you have extracted the 
archive into. The build process should complete with no errors. You will be left 
with the following executables:
<itemize>
<item><bf>flactag</bf> - The main application
<item><bf>discid</bf> - A test utility to read the disc ID from a CD
</itemize>
<sect>Ripping CDs to FLAC
<p>
I use the following script to rip my CDs to a single FLAC:
<code>
#!/bin/sh

if [ $1 ]
then

        FILENAME="$1-`date +"%Y-%m-%d.%H:%M:%S"`-$$"
        cdrdao read-cd --device /dev/hdc --driver generic-mmc --datafile $FILENAME.bin $FILENAME.toc
        cueconvert $FILENAME.toc $FILENAME.cue
        if nice flac -8 --replay-gain --endian=big --sign=signed --channels=2 --bps=16 --sample-rate=44100 --cuesheet=$FILENAME.cue $FILENAME.bin
        then
                rm -f $FILENAME.bin
                rm -f $FILENAME.toc
                rm -f $FILENAME.cue
        fi
else
        echo "Usage: $0 cdname"
fi
</code>

This script accepts one argument, the 'base' name of the CD you're ripping. The 
current date and time are appended to this base name. You will end up with a 
FLAC file ready to be used with flactag.

<sect>Using flactag
<p>
flactac should be executed from a linux console prompt, giving the path to the 
FLAC file to tag as its only argument as follows:

<tt>./flactag victory.flac</tt>

(filenames can be quoted if they contain special characters to avoid having 
to 'escape' these characters).

If the flactag utility does not find information for your CD, a URL will be 
provided to submit information for your CD. Often the MusicBrainz server will 
have information about the tracks and artist, but cannot match this up to your 
CD. In these circumstances, it is simply a matter of 'associating' your CDs 
DiskID with the correct album data on the MusicBrainz server. In other 
instances, you may be required to enter the track and album information into the 
MusicBrainz service. Once you have entered this information, you can re-run 
flactag, and the data should be downloaded from the MusicBrainz server.

If the flactag utility finds information for your CD at the musicbrainz server, 
the application's main window will be shown. This contains three main areas:

<enum> 

<item>The 'Albums' window. This will contain a list of albums that match 
the DiskID for your FLAC file.

<item>The 'Tracks' window. This contains a list of all the tracks on the 
currently selected album.

<item>The 'Tags' window. At startup, this will contain a list of the tags 
currently found in your FLAC file. If there are no tags present, then an empty 
set appropriate for the album will be displayed. If you make changes to these 
tags, an asterisk ('*') will be displayed to indicate that this information has 
been changed. 

</enum>
   
The currently active window will be highlighted by the border and window title 
changing colour. To switch between the three windows, press the '<bf>TAB</bf>' key. To 
scroll around the active window, use the cursor UP and DOWN keys. Scolling in 
the 'Albums' window will update the information in the 'Tracks' window 
appropriately.

Once the appropriate album has been selected, pressing '<bf>c</bf>' will copy the tags 
for that album into the 'Tags' window. These tags can then be saved to the FLAC 
file by pressing the '<bf>w</bf>' key.

Pressing '<bf>r</bf>' will rename the file based on the settings in the configuration file (
/.flactag). Note that this uses the tags that are actually written to the file, so should 
generally be performed after the new tags have been written to the file. This option will
be unavailable if the filename and location are already correct.

The following entries affect file renaming:
<itemize>

<item><bf>BasePath</bf> - This is the 'root' directory of where your music files 
should be stored.

<item><bf>SingleDiskFileName</bf> - This template is used to rename disks that 
are not part of a multi-disk set.

<item><bf>MultiDiskFileName</bf> - This template is used to rename disks that 
are part of a multi-disk set.

<item><bf>DirectoryCreatePermissions</bf> - The permissions to be set on any 
directory that is created.

</itemize>

The FileName templates can accept the following parameters:

<itemize>

<item><bf>%A</bf> - This will be replaced with the artist name

<item><bf>%S</bf> - This will be replaced with the artist sort name

<item><bf>%T</bf> - This will be replaced with the album title

<item><bf>%D</bf> - This will be replaced with the disk number

<item><bf>%Y</bf> - This will be replaced with the year

<item><bf>%G</bf> - This will be replaced with the genre

</itemize>

If any item is used but does not have a value, then it will be stored as (for 
example) NOGENRE (if the genre tag is empty).

Pressing '<bf>a</bf>' will download album art from Amazon is it is available. The album 
art will be stored as 'cover.jpg' in the same directory as the FLAC file. This 
should generally be performed after the file has been renamed. This option will be unavailable
if no Amazon ASIN is associated with the album on the MusicBrainz service.

The application can be exited by pressing the 'q' key.

<sect>Bugs / Limitations / Future Enhancements
<p>

<itemize>

<item>Once changes are written to the FLAC file, there is no way of reverting 
back to the original tags.

</itemize> 

<sect>Problems / Suggestions 
<p> 

If you have any problems with the software, or suggestions for improvements or 
new features, then please use the <url url="http://bugtracker.gently.org.uk/" 
name="Bug Tracking System"> to report them. 

<sect>Version History 
<sect1>v0.04 - xxx September 2006 

<p> 

<itemize> 

<item>Software released under the GPL 

<item>Add ability to rename file after tagging 

<item>Add logging capability (all log 
messages are queued and display on exit) 

<item>Add facility to download album cover art from Amazon 

<item>Store more Musicbrainz related information in tags 

</itemize> 

<sect1>v0.03 - 18th September 2006 
<p> 

<itemize> 

<item>Fix serious  bug in generating submission URLs 

</itemize> 

<sect1>v0.02 - 18th September 2006 
<p> 

<itemize> 

<item>Correctly handle multi-album disc sets 

<item>Include ARTISTSORT tag 

<item>Retrieve Amazon ASIN in preparation for downloading cover art 

</itemize> 

<sect1>v0.01 - 16th September 2006 

<p> 

<itemize> 

<item>Initial version 

</itemize> 

<em>$Id$</em> 

</article>